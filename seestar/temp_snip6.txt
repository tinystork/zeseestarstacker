                                            )
                                            self._current_batch_paths.append(file_path)
                                    else:
                                        classic_stack_item = (
                                            aligned_data,
                                            header_orig,
                                            scores_val,
                                            wcs_gen_val,
                                            valid_mask_val,
                                        )
                                        self._current_batch_paths.append(file_path)
                                    if classic_stack_item is not None:
                                        current_batch_items_with_masks_for_stack_batch.append(
                                            classic_stack_item
                                        )

                                if self.batch_size == 0:
                                    trigger = float("inf")
                                elif self.batch_size == 1 and getattr(
                                    self, "chunk_size", None
                                ):
                                    trigger = getattr(self, "chunk_size")
                                else:
                                    trigger = max(1, self.batch_size)
                                if (
                                    len(current_batch_items_with_masks_for_stack_batch)
                                    >= trigger
                                ):
                                    self.stacked_batches_count += 1
                                    self._send_eta_update()
                                    if self.drizzle_active_session:
