
        if not wcs_list:
            self.update_progress(
                "❌ Échec de la préparation de la grille : aucun WCS valide trouvé après résolution.",
                "ERROR",
            )
            return False

        if self.reference_wcs_object is None or not self.freeze_reference_wcs:
            # For ``batch_size == 1`` we mimic the behaviour of live stacking
            # (``batch_size == 0``) by adopting the first frame's WCS and
            # dimensions as the global grid. This avoids expanding the canvas
            # to the union of all dithered frames which previously produced a
            # grid twice as large (e.g. 3840x2160 for 1920x1080 inputs).
            if getattr(self, "batch_size", 0) == 1:
                wcs_list = wcs_list[:1]
                header_list = header_list[:1]
                ref_wcs = wcs_list[0]
                ref_shape = ref_wcs.pixel_shape
            elif (
                len(wcs_list) == 1
                and self.reproject_between_batches
                and not self.is_mosaic_run
            ):
                # When doing classic stacking with reprojection of a single
                # file, use the dynamic bounding-box logic to avoid cropping.
                ref_wcs, ref_shape = self._calculate_final_mosaic_grid_dynamic(
                    wcs_list,
                    header_list,
                    scale_factor=(
                        self.drizzle_scale if self.drizzle_active_session else 1.0
